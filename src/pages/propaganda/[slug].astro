---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import PropagandaPost from '../../layouts/PropagandaPost.astro';
import PropagandaMetaBox from '../../components/PropagandaMetaBox.astro';

export async function getStaticPaths() {
  const entries = await getCollection('propaganda');

  return entries.map((entry) => ({
    params: { slug: entry.id },
    props: entry,
  }));
}

type Props = CollectionEntry<'propaganda'>;

const entry = Astro.props as Props;
const { Content } = await render(entry);
---

<!-- Layout should NOT render an H1 under Option A -->
<PropagandaPost {...entry.data}>
  <!-- 1) Title -->
  <h1>{entry.data.title}</h1>

  <!-- 2) Metadata box -->
  <PropagandaMetaBox
    type={entry.data.type}
    year={entry.data.year}
    printSize={entry.data.printSize}
    orientation={entry.data.orientation}
    tags={entry.data.tags}
  />

  <!-- 3) Visual preview + download -->
  <section class="preview-area" aria-label="Preview and download">
    {entry.data.previewImage ? (
      <img src={entry.data.previewImage} alt={`Preview of ${entry.data.title}`} />
    ) : null}

    <div class="actions">
      <a class="download-button" href={entry.data.downloadFile} download>
        Download high-res file (PDF)
      </a>
      <!-- File: line removed (do not render it) -->
    </div>
  </section>

  <!-- 4) Description / history -->
  <article class="content" aria-label="Propaganda content">
    <Content />
  </article>

  <div>
    <a class="back-link" href="/propaganda">‚Üê Back to Propaganda Archive</a>
  </div>
</PropagandaPost>

<style>
  main { width: 960px; margin: 0 auto; }

  .preview-area {
    display: flex;
    gap: 1rem;
    align-items: flex-start;
    margin: 1rem 0;
  }

  .preview-area img {
    max-width: 360px;
    border-radius: 8px;
    width: 100%;
    height: auto;
    object-fit: cover;
    border: 1px solid rgba(0,0,0,0.15);
  }

  .actions { display: flex; flex-direction: column; gap: 0.5rem; }

  .download-button {
    display: inline-block;
    padding: 0.6rem 1rem;
    background: rgb(var(--accent));
    color: white;
    border-radius: 6px;
    text-decoration: none;
  }

  .content { margin-top: 1rem; }

  .back-link {
    display: inline-block;
    margin-top: 2rem;
    color: rgb(var(--gray));
    text-decoration: none;
  }

  @media (max-width: 720px) {
    main { width: auto; margin: 0 1rem; }
    .preview-area { flex-direction: column; }
    .preview-area img { max-width: 100%; }
  }
</style>
